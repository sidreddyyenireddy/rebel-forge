#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <math.h>

#define MAX(a,b)    ((a) < (b) ? (b) : (a))
#define MIN(a,b)    ((a) > (b) ? (b) : (a))

void rys_1rw(int nt, const double tval[restrict], double rts[restrict], double wts[restrict]) {
  int jump1[34] =
    { 1, 2, 2, 3, 3, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6,
      6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7
    };

  double e;
  int n;
  double t, x, f1, r1, w1;
  int tcase;
  
  for (n = 0; n < nt; ++n) {
    t = tval[n];

    if (t <= 3e-7) {
      r1 = .5 - t * .2;
      wts[n] *= 1. - t * .333333333333333;
      rts[n] = r1 / (r1 + 1.);
      goto L100;
    }
    tcase = (int) MIN ((t + 1.0), 34.);

    switch (jump1[tcase - 1])
      {
      case 1:
	goto L1100;
      case 2:
	goto L1200;
      case 3:
	goto L1300;
      case 4:
	goto L1400;
      case 5:
	goto L1500;
      case 6:
	goto L1600;
      case 7:
	goto L1700;
      }

  L1100:
    f1 = ((((((((t * -8.36313918003957e-8 + 1.21222603512827e-6) * t -
		1.15662609053481e-5) * t + 9.25197374512647e-5) * t -
	      6.40994113129432e-4) * t + .00378787044215009) * t -
	    .0185185172458485) * t + .0714285713298222) * t -
	  .199999999997023) * t + .333333333333318;
    w1 = (t + t) * f1 + exp (-t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1200:
    x = t - 2.;
    f1 = ((((((((((x * -1.61702782425558e-10 + 1.96215250865776e-9) * x -
		  2.14234468198419e-8) * x + 2.17216556336318e-7) * x -
		1.98850171329371e-6) * x + 1.62429321438911e-5) * x -
	      1.16740298039895e-4) * x + 7.24888732052332e-4) * x -
	    .00379490003707156) * x + .0161723488664661) * x -
	  .0529428148329736) * x + .115702180856167;
    w1 = (t + t) * f1 + exp (-t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1300:
    x = t - 4.;
    f1 = ((((((((((x * -2.62453564772299e-11 + 3.24031041623823e-10) * x
		  - 3.614965656163e-9) * x + 3.760256799971e-8) * x -
		3.553558319675e-7) * x + 3.022556449731e-6) * x -
	      2.290098979647e-5) * x + 1.526537461148e-4) * x -
	    8.81947375894379e-4) * x + .00433207949514611) * x -
	  .0175257821619926) * x + .0528406320615584;
    w1 = (t + t) * f1 + exp (-t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1400:
    e = exp (-t);
    x = 1. / t;
    w1 = ((((((x * .46897511375022 - .69955602298985) * x +
	      .53689283271887) * x - .32883030418398) * x +
	    .24645596956002) * x - .49984072848436) * x -
	  3.1501078774085e-6) * e + sqrt (x * .785398163397448);
    f1 = (w1 - e) / (t + t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1500:
    e = exp (-t);
    x = 1. / t;
    w1 = (((x * -.18784686463512 + .22991849164985) * x - .49893752514047)
	  * x - 2.1916512131607e-5) * e + sqrt (x * .785398163397448);
    f1 = (w1 - e) / (t + t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1600:
    e = exp (-t);
    x = 1. / t;
    w1 = ((x * .1962326414943 - .4969524146449) * x - 6.0156581186481e-5)
      * e + sqrt (x * .785398163397448);
    f1 = (w1 - e) / (t + t);
    r1 = f1 / (w1 - f1);
    wts[n] *= w1;
    rts[n] = r1 / (r1 + 1.);
    goto L100;

  L1700:
    wts[n] *= sqrt (.785398163397448 / t);
    rts[n] = .5 / t;
  L100:
    ;
  }
}
